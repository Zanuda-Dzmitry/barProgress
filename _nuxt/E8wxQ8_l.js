import{_ as w,e as g,c as _,C as E,X as O,Y as j,l as $,r as m,n as A,q as J,Z as Y,M as F,o as P,v as y}from"./CvKjYvnM.js";import{c as k}from"./Bhy5G53H.js";class d extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,d.prototype)}}const B=g({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(r,{expose:e,emit:t}){const l=F(),s=k(`form-${l}`),i=m(null);A(()=>{s.on(async n=>{var o;n.type!=="submit"&&((o=r.validateOn)!=null&&o.includes(n.type))&&await p(n.path,{silent:!0})})}),J(()=>{s.reset()});const a=m([]);y("form-errors",a),y("form-events",s);const h=m({});y("form-inputs",h);async function S(){let n=await r.validate(r.state);if(r.schema){const{errors:o,result:u}=await D(r.state,r.schema);o?n=n.concat(o):i.value=u}return n}async function p(n,o={silent:!1}){let u=n;if(n&&!Array.isArray(n)&&(u=[n]),u){const f=a.value.filter(c=>!u.includes(c.path)),v=(await S()).filter(c=>u.includes(c.path));a.value=f.concat(v)}else a.value=await S();if(a.value.length>0){if(o.silent)return!1;throw new d(`Form validation failed: ${JSON.stringify(a.value,null,2)}`)}return r.state}async function b(n){var u;const o=n;try{(u=r.validateOn)!=null&&u.includes("submit")&&await p(),o.data=r.schema?i.value:r.state,t("submit",o)}catch(f){if(!(f instanceof d))throw f;const v={...o,errors:a.value.map(c=>({...c,id:h.value[c.path]}))};t("error",v)}}return e({validate:p,errors:a,setErrors(n,o){o?a.value=a.value.filter(u=>u.path!==o).concat(n):a.value=n},async submit(){await b(new Event("submit"))},getErrors(n){return n?a.value.filter(o=>o.path===n):a.value},clear(n){n?a.value=a.value.filter(o=>o.path!==n):a.value=[]}}),{onSubmit:b,errors:Y(a)}}});function M(r){return r.validate&&r.__isYupSchema__}function V(r){return r.inner!==void 0}function Z(r){return"schema"in r&&typeof r.coercer=="function"&&typeof r.validator=="function"&&typeof r.refiner=="function"}function q(r){return r.validateAsync!==void 0&&r.id!==void 0}function C(r){return r.isJoi===!0}function I(r){return"_parse"in r||"_run"in r||typeof r=="function"&&"schema"in r}function U(r){return r.parse!==void 0}async function x(r,e){const t=await("_parse"in e?e._parse(r):"_run"in e?e._run({typed:!1,value:r},{}):e(r));return!t.issues||t.issues.length===0?{errors:null,result:"output"in t?t.output:"value"in t?t.value:null}:{errors:t.issues.map(s=>{var i;return{path:((i=s.path)==null?void 0:i.map(a=>a.key).join("."))||"",message:s.message}}),result:null}}async function z(r,e){try{return{errors:null,result:await e.validateAsync(r,{abortEarly:!1})}}catch(t){if(C(t))return{errors:t.details.map(s=>({path:s.path.join("."),message:s.message})),result:null};throw t}}async function N(r,e){const t=await e.safeParseAsync(r);return t.success===!1?{errors:t.error.issues.map(s=>({path:s.path.join("."),message:s.message})),result:null}:{result:t.data,errors:null}}async function R(r,e){const[t,l]=e.validate(r);return t?{errors:t.failures().map(i=>({message:i.message,path:i.path.join(".")})),result:null}:{errors:null,result:l}}async function X(r,e){try{return{errors:null,result:await e.validate(r,{abortEarly:!1})}}catch(t){if(V(t))return{errors:t.inner.map(s=>({path:s.path??"",message:s.message})),result:null};throw t}}function D(r,e){if(U(e))return N(r,e);if(q(e))return z(r,e);if(I(e))return x(r,e);if(M(e))return X(r,e);if(Z(e))return R(r,e);throw new Error("Form validation failed: Unsupported form schema")}function G(r,e,t,l,s,i){return P(),_("form",{onSubmit:e[0]||(e[0]=$((...a)=>r.onSubmit&&r.onSubmit(...a),["prevent"]))},[E(r.$slots,"default",O(j({errors:r.errors})))],32)}const L=w(B,[["render",G]]);export{L as default};
